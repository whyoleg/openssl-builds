# This file was generated using Kotlin DSL (.github/workflows/build.main.kts).
# If you want to modify the workflow, please change the Kotlin file and regenerate this YAML file.
# Generated with https://github.com/typesafegithub/github-workflows-kt

name: 'Build'
on:
  workflow_dispatch:
    inputs:
      version:
        description: 'version of OpenSSL 3'
        type: 'string'
        required: true
defaults:
  run:
    shell: 'bash'
jobs:
  macos:
    name: 'macos-${{ inputs.version }}'
    runs-on: 'macos-latest'
    steps:
    - id: 'step-0'
      uses: 'actions/checkout@v4'
      with:
        submodules: 'true'
    - id: 'step-1'
      uses: 'actions/setup-python@v5'
      with:
        python-version: '3.x'
    - id: 'step-2'
      run: 'pip install conan'
    - id: 'step-3'
      run: 'conan profile detect'
    - id: 'step-4'
      run: 'conan create conan-center-index/recipes/openssl/3.x.x --build=missing --version=${{ inputs.version }} -pr:b default -pr:h profiles/tvos-simulator-arm64 -o "*:shared=False"'
    - id: 'step-5'
      run: 'conan install packages/openssl3 --output-folder build/openssl3/tvos-simulator-arm64 --version=${{ inputs.version }} -pr:b default -pr:h profiles/tvos-simulator-arm64 -o "*:shared=False"'
    - id: 'step-6'
      run: 'conan create conan-center-index/recipes/openssl/3.x.x --build=missing --version=${{ inputs.version }} -pr:b default -pr:h profiles/tvos-simulator-x64 -o "*:shared=False"'
    - id: 'step-7'
      run: 'conan install packages/openssl3 --output-folder build/openssl3/tvos-simulator-x64 --version=${{ inputs.version }} -pr:b default -pr:h profiles/tvos-simulator-x64 -o "*:shared=False"'
    - id: 'step-8'
      run: 'conan create conan-center-index/recipes/openssl/3.x.x --build=missing --version=${{ inputs.version }} -pr:b default -pr:h profiles/tvos-device-arm64 -o "*:shared=False"'
    - id: 'step-9'
      run: 'conan install packages/openssl3 --output-folder build/openssl3/tvos-device-arm64 --version=${{ inputs.version }} -pr:b default -pr:h profiles/tvos-device-arm64 -o "*:shared=False"'
    - id: 'step-10'
      run: 'conan create conan-center-index/recipes/openssl/3.x.x --build=missing --version=${{ inputs.version }} -pr:b default -pr:h profiles/watchos-simulator-arm64 -o "*:shared=False"'
    - id: 'step-11'
      run: 'conan install packages/openssl3 --output-folder build/openssl3/watchos-simulator-arm64 --version=${{ inputs.version }} -pr:b default -pr:h profiles/watchos-simulator-arm64 -o "*:shared=False"'
    - id: 'step-12'
      run: 'conan create conan-center-index/recipes/openssl/3.x.x --build=missing --version=${{ inputs.version }} -pr:b default -pr:h profiles/watchos-simulator-x64 -o "*:shared=False"'
    - id: 'step-13'
      run: 'conan install packages/openssl3 --output-folder build/openssl3/watchos-simulator-x64 --version=${{ inputs.version }} -pr:b default -pr:h profiles/watchos-simulator-x64 -o "*:shared=False"'
    - id: 'step-14'
      run: 'conan create conan-center-index/recipes/openssl/3.x.x --build=missing --version=${{ inputs.version }} -pr:b default -pr:h profiles/watchos-device-arm32 -o "*:shared=False"'
    - id: 'step-15'
      run: 'conan install packages/openssl3 --output-folder build/openssl3/watchos-device-arm32 --version=${{ inputs.version }} -pr:b default -pr:h profiles/watchos-device-arm32 -o "*:shared=False"'
    - id: 'step-16'
      run: 'conan create conan-center-index/recipes/openssl/3.x.x --build=missing --version=${{ inputs.version }} -pr:b default -pr:h profiles/watchos-device-arm64 -o "*:shared=False"'
    - id: 'step-17'
      run: 'conan install packages/openssl3 --output-folder build/openssl3/watchos-device-arm64 --version=${{ inputs.version }} -pr:b default -pr:h profiles/watchos-device-arm64 -o "*:shared=False"'
    - id: 'step-18'
      run: 'conan create conan-center-index/recipes/openssl/3.x.x --build=missing --version=${{ inputs.version }} -pr:b default -pr:h profiles/watchos-device-arm64_32 -o "*:shared=False"'
    - id: 'step-19'
      run: 'conan install packages/openssl3 --output-folder build/openssl3/watchos-device-arm64_32 --version=${{ inputs.version }} -pr:b default -pr:h profiles/watchos-device-arm64_32 -o "*:shared=False"'
    - id: 'step-20'
      run: 'conan create conan-center-index/recipes/openssl/3.x.x --build=missing --version=${{ inputs.version }} -pr:b default -pr:h profiles/ios-device-arm64 -o "*:shared=False"'
    - id: 'step-21'
      run: 'conan install packages/openssl3 --output-folder build/openssl3/ios-device-arm64 --version=${{ inputs.version }} -pr:b default -pr:h profiles/ios-device-arm64 -o "*:shared=False"'
    - id: 'step-22'
      run: 'conan create conan-center-index/recipes/openssl/3.x.x --build=missing --version=${{ inputs.version }} -pr:b default -pr:h profiles/ios-simulator-arm64 -o "*:shared=False"'
    - id: 'step-23'
      run: 'conan install packages/openssl3 --output-folder build/openssl3/ios-simulator-arm64 --version=${{ inputs.version }} -pr:b default -pr:h profiles/ios-simulator-arm64 -o "*:shared=False"'
    - id: 'step-24'
      run: 'conan create conan-center-index/recipes/openssl/3.x.x --build=missing --version=${{ inputs.version }} -pr:b default -pr:h profiles/ios-simulator-x64 -o "*:shared=False"'
    - id: 'step-25'
      run: 'conan install packages/openssl3 --output-folder build/openssl3/ios-simulator-x64 --version=${{ inputs.version }} -pr:b default -pr:h profiles/ios-simulator-x64 -o "*:shared=False"'
    - id: 'step-26'
      run: 'conan create conan-center-index/recipes/openssl/3.x.x --build=missing --version=${{ inputs.version }} -pr:b default -pr:h profiles/macos-x64 -o "*:shared=True"'
    - id: 'step-27'
      run: 'conan install packages/openssl3 --output-folder build/openssl3/macos-x64 --version=${{ inputs.version }} -pr:b default -pr:h profiles/macos-x64 -o "*:shared=True"'
    - id: 'step-28'
      run: 'conan create conan-center-index/recipes/openssl/3.x.x --build=missing --version=${{ inputs.version }} -pr:b default -pr:h profiles/macos-x64 -o "*:shared=False"'
    - id: 'step-29'
      run: 'conan install packages/openssl3 --output-folder build/openssl3/macos-x64 --version=${{ inputs.version }} -pr:b default -pr:h profiles/macos-x64 -o "*:shared=False"'
    - id: 'step-30'
      run: 'conan create conan-center-index/recipes/openssl/3.x.x --build=missing --version=${{ inputs.version }} -pr:b default -pr:h profiles/macos-arm64 -o "*:shared=True"'
    - id: 'step-31'
      run: 'conan install packages/openssl3 --output-folder build/openssl3/macos-arm64 --version=${{ inputs.version }} -pr:b default -pr:h profiles/macos-arm64 -o "*:shared=True"'
    - id: 'step-32'
      run: 'conan create conan-center-index/recipes/openssl/3.x.x --build=missing --version=${{ inputs.version }} -pr:b default -pr:h profiles/macos-arm64 -o "*:shared=False"'
    - id: 'step-33'
      run: 'conan install packages/openssl3 --output-folder build/openssl3/macos-arm64 --version=${{ inputs.version }} -pr:b default -pr:h profiles/macos-arm64 -o "*:shared=False"'
    - id: 'step-34'
      run: 'tar -rvf macos.tar build/openssl3/*/lib'
    - id: 'step-35'
      run: 'tar -rvf macos.tar build/openssl3/*/include'
    - id: 'step-36'
      uses: 'actions/upload-artifact@v4'
      with:
        name: 'openssl-macos-${{ inputs.version }}'
        path: 'macos.tar'
        if-no-files-found: 'error'
  linux:
    name: 'linux-${{ inputs.version }}'
    runs-on: 'ubuntu-latest'
    steps:
    - id: 'step-0'
      uses: 'actions/checkout@v4'
      with:
        submodules: 'true'
    - id: 'step-1'
      uses: 'actions/setup-python@v5'
      with:
        python-version: '3.x'
    - id: 'step-2'
      run: 'pip install conan'
    - id: 'step-3'
      run: 'conan profile detect'
    - id: 'step-4'
      run: 'sudo apt update'
    - id: 'step-5'
      run: 'sudo apt install g++-8-aarch64-linux-gnu g++-8'
    - id: 'step-6'
      run: 'conan create conan-center-index/recipes/openssl/3.x.x --build=missing --version=${{ inputs.version }} -pr:b default -pr:h profiles/android-arm64 -o "*:shared=True"'
    - id: 'step-7'
      run: 'conan install packages/openssl3 --output-folder build/openssl3/android-arm64 --version=${{ inputs.version }} -pr:b default -pr:h profiles/android-arm64 -o "*:shared=True"'
    - id: 'step-8'
      run: 'conan create conan-center-index/recipes/openssl/3.x.x --build=missing --version=${{ inputs.version }} -pr:b default -pr:h profiles/android-arm64 -o "*:shared=False"'
    - id: 'step-9'
      run: 'conan install packages/openssl3 --output-folder build/openssl3/android-arm64 --version=${{ inputs.version }} -pr:b default -pr:h profiles/android-arm64 -o "*:shared=False"'
    - id: 'step-10'
      run: 'conan create conan-center-index/recipes/openssl/3.x.x --build=missing --version=${{ inputs.version }} -pr:b default -pr:h profiles/android-arm32 -o "*:shared=True"'
    - id: 'step-11'
      run: 'conan install packages/openssl3 --output-folder build/openssl3/android-arm32 --version=${{ inputs.version }} -pr:b default -pr:h profiles/android-arm32 -o "*:shared=True"'
    - id: 'step-12'
      run: 'conan create conan-center-index/recipes/openssl/3.x.x --build=missing --version=${{ inputs.version }} -pr:b default -pr:h profiles/android-arm32 -o "*:shared=False"'
    - id: 'step-13'
      run: 'conan install packages/openssl3 --output-folder build/openssl3/android-arm32 --version=${{ inputs.version }} -pr:b default -pr:h profiles/android-arm32 -o "*:shared=False"'
    - id: 'step-14'
      run: 'conan create conan-center-index/recipes/openssl/3.x.x --build=missing --version=${{ inputs.version }} -pr:b default -pr:h profiles/android-x64 -o "*:shared=True"'
    - id: 'step-15'
      run: 'conan install packages/openssl3 --output-folder build/openssl3/android-x64 --version=${{ inputs.version }} -pr:b default -pr:h profiles/android-x64 -o "*:shared=True"'
    - id: 'step-16'
      run: 'conan create conan-center-index/recipes/openssl/3.x.x --build=missing --version=${{ inputs.version }} -pr:b default -pr:h profiles/android-x64 -o "*:shared=False"'
    - id: 'step-17'
      run: 'conan install packages/openssl3 --output-folder build/openssl3/android-x64 --version=${{ inputs.version }} -pr:b default -pr:h profiles/android-x64 -o "*:shared=False"'
    - id: 'step-18'
      run: 'conan create conan-center-index/recipes/openssl/3.x.x --build=missing --version=${{ inputs.version }} -pr:b default -pr:h profiles/android-x86 -o "*:shared=True"'
    - id: 'step-19'
      run: 'conan install packages/openssl3 --output-folder build/openssl3/android-x86 --version=${{ inputs.version }} -pr:b default -pr:h profiles/android-x86 -o "*:shared=True"'
    - id: 'step-20'
      run: 'conan create conan-center-index/recipes/openssl/3.x.x --build=missing --version=${{ inputs.version }} -pr:b default -pr:h profiles/android-x86 -o "*:shared=False"'
    - id: 'step-21'
      run: 'conan install packages/openssl3 --output-folder build/openssl3/android-x86 --version=${{ inputs.version }} -pr:b default -pr:h profiles/android-x86 -o "*:shared=False"'
    - id: 'step-22'
      run: 'conan create conan-center-index/recipes/openssl/3.x.x --build=missing --version=${{ inputs.version }} -pr:b default -pr:h profiles/linux-x64 -o "*:shared=True"'
    - id: 'step-23'
      run: 'conan install packages/openssl3 --output-folder build/openssl3/linux-x64 --version=${{ inputs.version }} -pr:b default -pr:h profiles/linux-x64 -o "*:shared=True"'
    - id: 'step-24'
      run: 'conan create conan-center-index/recipes/openssl/3.x.x --build=missing --version=${{ inputs.version }} -pr:b default -pr:h profiles/linux-x64 -o "*:shared=False"'
    - id: 'step-25'
      run: 'conan install packages/openssl3 --output-folder build/openssl3/linux-x64 --version=${{ inputs.version }} -pr:b default -pr:h profiles/linux-x64 -o "*:shared=False"'
    - id: 'step-26'
      run: 'conan create conan-center-index/recipes/openssl/3.x.x --build=missing --version=${{ inputs.version }} -pr:b default -pr:h profiles/linux-arm64 -o "*:shared=True"'
    - id: 'step-27'
      run: 'conan install packages/openssl3 --output-folder build/openssl3/linux-arm64 --version=${{ inputs.version }} -pr:b default -pr:h profiles/linux-arm64 -o "*:shared=True"'
    - id: 'step-28'
      run: 'conan create conan-center-index/recipes/openssl/3.x.x --build=missing --version=${{ inputs.version }} -pr:b default -pr:h profiles/linux-arm64 -o "*:shared=False"'
    - id: 'step-29'
      run: 'conan install packages/openssl3 --output-folder build/openssl3/linux-arm64 --version=${{ inputs.version }} -pr:b default -pr:h profiles/linux-arm64 -o "*:shared=False"'
    - id: 'step-30'
      run: 'conan create conan-center-index/recipes/openssl/3.x.x --build=missing --version=${{ inputs.version }} -pr:b default -pr:h profiles/wasm -o "*:shared=False"'
    - id: 'step-31'
      run: 'conan install packages/openssl3 --output-folder build/openssl3/wasm --version=${{ inputs.version }} -pr:b default -pr:h profiles/wasm -o "*:shared=False"'
    - id: 'step-32'
      run: 'tar -rvf linux.tar build/openssl3/*/lib'
    - id: 'step-33'
      run: 'tar -rvf linux.tar build/openssl3/*/include'
    - id: 'step-34'
      uses: 'actions/upload-artifact@v4'
      with:
        name: 'openssl-linux-${{ inputs.version }}'
        path: 'linux.tar'
        if-no-files-found: 'error'
  windows:
    name: 'windows-${{ inputs.version }}'
    runs-on: 'windows-latest'
    steps:
    - id: 'step-0'
      uses: 'actions/checkout@v4'
      with:
        submodules: 'true'
    - id: 'step-1'
      uses: 'actions/setup-python@v5'
      with:
        python-version: '3.x'
    - id: 'step-2'
      run: 'pip install conan'
    - id: 'step-3'
      run: 'conan profile detect'
    - id: 'step-4'
      run: 'conan create conan-center-index/recipes/openssl/3.x.x --build=missing --version=${{ inputs.version }} -pr:b default -pr:h profiles/mingw-x64 -o "*:shared=True"'
    - id: 'step-5'
      run: 'conan install packages/openssl3 --output-folder build/openssl3/mingw-x64 --version=${{ inputs.version }} -pr:b default -pr:h profiles/mingw-x64 -o "*:shared=True"'
    - id: 'step-6'
      run: 'conan create conan-center-index/recipes/openssl/3.x.x --build=missing --version=${{ inputs.version }} -pr:b default -pr:h profiles/mingw-x64 -o "*:shared=False"'
    - id: 'step-7'
      run: 'conan install packages/openssl3 --output-folder build/openssl3/mingw-x64 --version=${{ inputs.version }} -pr:b default -pr:h profiles/mingw-x64 -o "*:shared=False"'
    - id: 'step-8'
      run: 'conan create conan-center-index/recipes/openssl/3.x.x --build=missing --version=${{ inputs.version }} -pr:b default -pr:h profiles/windows-x64 -o "*:shared=True"'
    - id: 'step-9'
      run: 'conan install packages/openssl3 --output-folder build/openssl3/windows-x64 --version=${{ inputs.version }} -pr:b default -pr:h profiles/windows-x64 -o "*:shared=True"'
    - id: 'step-10'
      run: 'tar -rvf windows.tar build/openssl3/*/lib'
    - id: 'step-11'
      run: 'tar -rvf windows.tar build/openssl3/*/include'
    - id: 'step-12'
      run: 'tar -rvf windows.tar build/openssl3/*/bin'
    - id: 'step-13'
      uses: 'actions/upload-artifact@v4'
      with:
        name: 'openssl-windows-${{ inputs.version }}'
        path: 'windows.tar'
        if-no-files-found: 'error'
  aggregate:
    runs-on: 'ubuntu-latest'
    needs:
    - 'macos'
    - 'linux'
    - 'windows'
    steps:
    - id: 'step-0'
      uses: 'actions/download-artifact@v4'
      with:
        pattern: 'openssl-*-${{ inputs.version }}'
        merge-multiple: 'true'
    - id: 'step-1'
      run: 'tar -xvf macos.tar'
    - id: 'step-2'
      run: 'tar -xvf linux.tar'
    - id: 'step-3'
      run: 'tar -xvf windows.tar'
    - id: 'step-4'
      working-directory: 'build/openssl3'
      run: 'tar -czvf ../../openssl-${{ inputs.version }}.tar.gz *'
    - id: 'step-5'
      working-directory: 'build/openssl3'
      run: 'zip --symlinks -r ../../openssl-${{ inputs.version }}.zip *'
    - id: 'step-6'
      uses: 'actions/upload-artifact@v4'
      with:
        name: 'openssl-${{ inputs.version }}'
        path: |-
          openssl-${{ inputs.version }}.tar.gz
          openssl-${{ inputs.version }}.zip
        if-no-files-found: 'error'
