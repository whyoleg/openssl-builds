# This file was generated using Kotlin DSL (.github/workflows/build.main.kts).
# If you want to modify the workflow, please change the Kotlin file and regenerate this YAML file.
# Generated with https://github.com/typesafegithub/github-workflows-kt

name: 'Build'
on:
  push: {}
defaults:
  run:
    shell: 'bash'
jobs:
  macos:
    name: 'macos-8.10.1'
    runs-on: 'macos-latest'
    steps:
    - id: 'step-0'
      uses: 'actions/checkout@v4'
      with:
        submodules: 'true'
    - id: 'step-1'
      uses: 'actions/setup-python@v5'
      with:
        python-version: '3.x'
    - id: 'step-2'
      run: 'pip install conan'
    - id: 'step-3'
      run: 'conan profile detect'
    - id: 'step-4'
      continue-on-error: true
      run: 'conan install packages/libcurl --output-folder build/libcurl/macos-x64 --build=missing --version=8.10.1 -pr:b default -pr:h profiles/macos-x64 -o "*:shared=True"'
    - id: 'step-5'
      continue-on-error: true
      run: 'conan install packages/libcurl --output-folder build/libcurl/macos-x64 --build=missing --version=8.10.1 -pr:b default -pr:h profiles/macos-x64 -o "*:shared=False"'
    - id: 'step-6'
      continue-on-error: true
      run: 'conan install packages/libcurl --output-folder build/libcurl/macos-arm64 --build=missing --version=8.10.1 -pr:b default -pr:h profiles/macos-arm64 -o "*:shared=True"'
    - id: 'step-7'
      continue-on-error: true
      run: 'conan install packages/libcurl --output-folder build/libcurl/macos-arm64 --build=missing --version=8.10.1 -pr:b default -pr:h profiles/macos-arm64 -o "*:shared=False"'
    - id: 'step-8'
      continue-on-error: true
      run: 'tar -rvf macos.tar build/libcurl/*/lib'
    - id: 'step-9'
      continue-on-error: true
      run: 'tar -rvf macos.tar build/libcurl/*/include'
    - id: 'step-10'
      continue-on-error: true
      uses: 'actions/upload-artifact@v4'
      with:
        name: 'libcurl-macos-8.10.1'
        path: 'macos.tar'
        if-no-files-found: 'error'
  linux:
    name: 'linux-8.10.1'
    runs-on: 'ubuntu-20.04'
    steps:
    - id: 'step-0'
      uses: 'actions/checkout@v4'
      with:
        submodules: 'true'
    - id: 'step-1'
      uses: 'actions/setup-python@v5'
      with:
        python-version: '3.x'
    - id: 'step-2'
      run: 'pip install conan'
    - id: 'step-3'
      run: 'conan profile detect'
    - id: 'step-4'
      run: 'sudo apt update'
    - id: 'step-5'
      run: 'sudo apt install g++-8-aarch64-linux-gnu g++-8'
    - id: 'step-6'
      continue-on-error: true
      run: 'conan install packages/libcurl --output-folder build/libcurl/linux-x64 --build=missing --version=8.10.1 -pr:b default -pr:h profiles/linux-x64 -o "*:shared=True"'
    - id: 'step-7'
      continue-on-error: true
      run: 'conan install packages/libcurl --output-folder build/libcurl/linux-x64 --build=missing --version=8.10.1 -pr:b default -pr:h profiles/linux-x64 -o "*:shared=False"'
    - id: 'step-8'
      continue-on-error: true
      run: 'conan install packages/libcurl --output-folder build/libcurl/linux-arm64 --build=missing --version=8.10.1 -pr:b default -pr:h profiles/linux-arm64 -o "*:shared=True"'
    - id: 'step-9'
      continue-on-error: true
      run: 'conan install packages/libcurl --output-folder build/libcurl/linux-arm64 --build=missing --version=8.10.1 -pr:b default -pr:h profiles/linux-arm64 -o "*:shared=False"'
    - id: 'step-10'
      continue-on-error: true
      run: 'tar -rvf linux.tar build/libcurl/*/lib'
    - id: 'step-11'
      continue-on-error: true
      run: 'tar -rvf linux.tar build/libcurl/*/include'
    - id: 'step-12'
      continue-on-error: true
      uses: 'actions/upload-artifact@v4'
      with:
        name: 'libcurl-linux-8.10.1'
        path: 'linux.tar'
        if-no-files-found: 'error'
  windows:
    name: 'windows-8.10.1'
    runs-on: 'windows-latest'
    steps:
    - id: 'step-0'
      uses: 'actions/checkout@v4'
      with:
        submodules: 'true'
    - id: 'step-1'
      uses: 'actions/setup-python@v5'
      with:
        python-version: '3.x'
    - id: 'step-2'
      run: 'pip install conan'
    - id: 'step-3'
      run: 'conan profile detect'
    - id: 'step-4'
      continue-on-error: true
      run: 'conan install packages/libcurl --output-folder build/libcurl/mingw-x64 --build=missing --version=8.10.1 -pr:b default -pr:h profiles/mingw-x64 -o "*:shared=True"'
    - id: 'step-5'
      continue-on-error: true
      run: 'conan install packages/libcurl --output-folder build/libcurl/mingw-x64 --build=missing --version=8.10.1 -pr:b default -pr:h profiles/mingw-x64 -o "*:shared=False"'
    - id: 'step-6'
      continue-on-error: true
      run: 'tar -rvf windows.tar build/libcurl/*/lib'
    - id: 'step-7'
      continue-on-error: true
      run: 'tar -rvf windows.tar build/libcurl/*/include'
    - id: 'step-8'
      continue-on-error: true
      run: 'tar -rvf windows.tar build/libcurl/*/bin'
    - id: 'step-9'
      continue-on-error: true
      uses: 'actions/upload-artifact@v4'
      with:
        name: 'libcurl-windows-8.10.1'
        path: 'windows.tar'
        if-no-files-found: 'error'
  aggregate:
    runs-on: 'ubuntu-latest'
    needs:
    - 'macos'
    - 'linux'
    - 'windows'
    steps:
    - id: 'step-0'
      uses: 'actions/download-artifact@v4'
      with:
        pattern: 'libcurl-*-8.10.1'
        merge-multiple: 'true'
    - id: 'step-1'
      run: 'tar -xvf macos.tar'
    - id: 'step-2'
      run: 'tar -xvf linux.tar'
    - id: 'step-3'
      run: 'tar -xvf windows.tar'
    - id: 'step-4'
      working-directory: 'build/libcurl'
      run: 'tar -czvf ../../libcurl-8.10.1.tar.gz *'
    - id: 'step-5'
      working-directory: 'build/libcurl'
      run: 'zip --symlinks -r ../../libcurl-8.10.1.zip *'
    - id: 'step-6'
      uses: 'actions/upload-artifact@v4'
      with:
        name: 'libcurl-8.10.1'
        path: |-
          libcurl-8.10.1.tar.gz
          libcurl-8.10.1.zip
        if-no-files-found: 'error'
